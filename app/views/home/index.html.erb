<div class="mainbanner">
    <div class="main-img-box">
        <%=image_tag("mainImg.jpg", class:"main-image")%>
    </div>
    <div class="mainbanner-btn-box">
        <%=link_to freeboards_path do%>
            <div class="mainbanner-button">커뮤니티 바로가기</div>
        <%end%>
    </div>
</div>

<div id="main-contents" class="container">
  <div id="allergy-filtering" class="d-flex justify-content-center">
    <div class="alg-filt-title">알레르기 성분 검색</div>
  </div>
  <div class="search-full-box">
  <%= render partial: 'home/search' %>
  </div>
  <div class="form-group" style="margin-top: 50px;">
    
            
    <% if user_signed_in? %> 
      <% if current_user.profile.nil? %> 
      <div>   <%= link_to "My Page", new_profile_path(@profile), class:"headerfont", :style=>"text-decoration: none; color: #454338;" %>
      <% elsif !current_user.profile.nil? %>
      <div>     <%= link_to "My Page", profile_path(current_user.profile.id), class:"headerfont", :style=>"text-decoration: none; color: #454338;"  %>
      <% end %>
      <%# elsif owner_signed_in?%>
      <%#= link_to "나의 식당관리", home_myrt_path, class:"headerfont", :style=>"text-decoration: none; color: #454338;" %>    
    <% end %>
    <div><%= link_to "크롤링 업데이트", "/crawling"%></div>

  </div>
  
</div>

<%#= javascript_include_tag('searchmain.js') %>
<script>
    
    $(".btn-allergy").click(function(){
        
            $(this).children('.btn-searchtype-circle').addClass("active-btn");
            $(this).children('.btn-searchtype-circle').children('div').addClass("active-btn-inside");
            $(this).children('.category-name').addClass('active-typename');
            
            $(".btn-restaurant").children('.btn-searchtype-circle').removeClass("active-btn");
            $(".btn-restaurant").children('.btn-searchtype-circle').children('div').removeClass("active-btn-inside");
            $(".btn-restaurant").children('.category-name').removeClass('active-typename');
            
            $(".restaurant-search").addClass("nodisplay");
            $(".allergy-search").removeClass("nodisplay");
        
    });

    $(".btn-restaurant").click(function(){
        
            $(this).children('.btn-searchtype-circle').addClass("active-btn");
            $(this).children('.btn-searchtype-circle').children('div').addClass("active-btn-inside");
            $(this).children('.category-name').addClass('active-typename');
            
            $(".btn-allergy").children('.btn-searchtype-circle').removeClass("active-btn");
            $(".btn-allergy").children('.btn-searchtype-circle').children('div').removeClass("active-btn-inside");
            $(".btn-allergy").children('.category-name').removeClass('active-typename');

            $(".restaurant-search").removeClass("nodisplay");
            $(".allergy-search").addClass("nodisplay");
        
    });
    
    var sigungu;
    var sigungu_length;
    // $("#custom").click(function(){
    //     if('<%=user_signed_in?%>'==="false"){
    //         alert("로그인이 필요한 기능입니다.")
    //     }
    // });
    $(".sido-select").click(function() {
        var sido = $(this).val();
        
        $.ajax({
            async : true,
            data : {sido : sido},
            type : "GET",
            url : "menus/getGungu",
            success : function(data){
                
                sigungu = data["sigungu_name"];
                if(sido != "전체"){
                    sigungu_length = Object.keys(sigungu).length;
                    var options = '';
                    options += '<option value="' +"전체"+ '">' + "시・군・구 찾기" + '</option>';
                    for (var i = 0; i <sigungu_length; i++) {
                        options += '<option value="' + sigungu[i]+'"'+'class='+'"sigungu-opt"'+'>' + sigungu[i] + '</option>';
                    }
                    $(".sigungu-select").html(options);
                }
            }
        })
    });
    // $(".a-submit").click(function(){
    //     if($(".origin-sido").val()=="시도"){
    //          alert("시/도를 선택하세요");
    //          return false;//alert 창 닫기.
    //     }
    // });
   if('<%=user_signed_in?%>'=="true"){
    $("#custom").click(function(){
            if( $(this).children("#ct").html() == "개인정보 불러오기")
            {   
                $(".original-check").addClass("getinfo");
                $("#myinfo").removeClass("getinfo");
                $(".allergy-check").css('visibility','visible');
            
                $(this).children("#ct").html("되돌리기");
                
                $(".custom-sido").val($(".origin-sido").val());
                $(".custom-sigungu").val($(".origin-sigungu").val());
                
            }
            else
            {
                $(".original-check").removeClass("getinfo");
                $("#myinfo").addClass("getinfo");
                $(this).children("#ct").html("개인정보 불러오기");
                $(".origin-sido").val($(".custom-sido").val());
                $(".origin-sigungu").val($(".custom-sigungu").val());
                
            }
        });
    }
    //페이지 뒤로 넘어가기 했을 시에 에러 수정.
    var sido = $(".sido-select").val();
    
    if(sido != "전체"){
    $.ajax({
        async : true,
        data : {sido : sido},
        type : "GET",
        url : "menus/getGungu",
        success : function(data){
            
            sigungu = data["sigungu_name"];
            if(sido != "전체"){
                sigungu_length = Object.keys(sigungu).length;
                var options = '';
                options += '<option value="' +"전체"+ '">' + "시・군・구 찾기" + '</option>';
                for (var i = 0; i <sigungu_length; i++) {
                    options += '<option value="' + sigungu[i]+'"'+'class='+'"sigungu-opt"'+'>' + sigungu[i] + '</option>';
                }
                $(".sigungu-select").html(options);
            }
        }
    });
    }

    $(".allergy-cp").click(function() {
        var allergy = $(this).attr('id');
        if($(this).hasClass('allergy-cp-active')){
            $(this).removeClass('allergy-cp-active');
            if(allergy == "a1") $("#a1_maemil").prop('checked', false);
            else if(allergy == "a2") $("#a2_mil").prop('checked', false);
            else if(allergy == "a3") $("#a3_daedu").prop('checked', false);
            else if(allergy == "a4") $("#a4_hodu").prop('checked', false);
            else if(allergy == "a5") $("#a5_ddangkong").prop('checked', false);
            else if(allergy == "a6") $("#a6_peach").prop('checked', false);
            else if(allergy == "a7") $("#a7_tomato").prop('checked', false);
            else if(allergy == "a8") $("#a8_piggogi").prop('checked', false);
            else if(allergy == "a9") $("#a9_nanryu").prop('checked', false);
            else if(allergy == "a10") $("#a10_milk").prop('checked', false);
            else if(allergy == "a11") $("#a11_ddakgogi").prop('checked', false);
            else if(allergy == "a12") $("#a12_shoigogi").prop('checked', false);
            else if(allergy == "a13") $("#a13_saewoo").prop('checked', false);
            else if(allergy == "a14") $("#a14_godeungeoh").prop('checked', false);
            else if(allergy == "a15") $("#a15_honghap").prop('checked', false);
            else if(allergy == "a16") $("#a16_junbok").prop('checked', false);
            else if(allergy == "a17") $("#a17_gul").prop('checked', false);
            else if(allergy == "a18") $("#a18_jogaeryu").prop('checked', false);
            else if(allergy == "a19") $("#a19_gye").prop('checked', false);
            else if(allergy == "a20") $("#a20_ohjingeoh").prop('checked', false);
            else if(allergy == "a21") $("#a21_ahwangsan").prop('checked', false);
            //배경색이 있는 그림이라서 바꿀 수가 없다. 일러스트를 흰색으로 못 바꿈.
            //$(this).children('img').removeClass('allergy-cp-img-active');
        }
        else{
            $(this).addClass('allergy-cp-active');
            if(allergy == "a1") $("#a1_maemil").prop('checked', true);
            else if(allergy == "a2") $("#a2_mil").prop('checked', true);
            else if(allergy == "a3") $("#a3_daedu").prop('checked', true);
            else if(allergy == "a4") $("#a4_hodu").prop('checked', true);
            else if(allergy == "a5") $("#a5_ddangkong").prop('checked', true);
            else if(allergy == "a6") $("#a6_peach").prop('checked', true);
            else if(allergy == "a7") $("#a7_tomato").prop('checked', true);
            else if(allergy == "a8") $("#a8_piggogi").prop('checked', true);
            else if(allergy == "a9") $("#a9_nanryu").prop('checked', true);
            else if(allergy == "a10") $("#a10_milk").prop('checked', true);
            else if(allergy == "a11") $("#a11_ddakgogi").prop('checked', true);
            else if(allergy == "a12") $("#a12_shoigogi").prop('checked', true);
            else if(allergy == "a13") $("#a13_saewoo").prop('checked', true);
            else if(allergy == "a14") $("#a14_godeungeoh").prop('checked', true);
            else if(allergy == "a15") $("#a15_honghap").prop('checked', true);
            else if(allergy == "a16") $("#a16_junbok").prop('checked', true);
            else if(allergy == "a17") $("#a17_gul").prop('checked', true);
            else if(allergy == "a18") $("#a18_jogaeryu").prop('checked', true);
            else if(allergy == "a19") $("#a19_gye").prop('checked', true);
            else if(allergy == "a20") $("#a20_ohjingeoh").prop('checked', true);
            else if(allergy == "a21") $("#a21_ahwangsan").prop('checked', true);
            //$(this).children('img').addClass('allergy-cp-img-active');
        }
        
        
        console.log(allergy);

        // $.ajax({
        //     async : true,
        //     data : {allergy: allergy},
        //     type : "GET",
        //     url : "menus/index",
        //     success : function(data){
        //         console.log("성공");
        //     }
        // })
    });
    //에러 수정 끝
</script>