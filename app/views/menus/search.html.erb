
<div class="menu">
    <h1 class="title">Filter by Allergy . . .</h1>

    <%# location은 partial location2는 그냥 %>
    <div class="original-check">
        <%= form_tag(menus_path, method: :get) do %>
            <div class="ziyuk d-flex">
                <div class="sido">
                <%#= select :sido, options_for_select([["서울특별시", "서울특별시"], ["부산광역시","부산광역시"], ["대구광역시","대구광역시"],["60대이상","60대이상"]]) %>  
                    <select name="sido" class="origin-sido sido-select options selectcss">
                        <option value="시도" class="sido-opt">--시/도--</option>
                        <option value="서울특별시" class="sido-opt">서울특별시</option>
                        <option value="부산광역시" class="sido-opt">부산광역시</option>
                        <option value="대구광역시" class="sido-opt">대구광역시</option> 
                        <option value="인천광역시" class="sido-opt">인천광역시</option>     
                        <option value="광주광역시" class="sido-opt">광주광역시</option>
                        <option value="대전광역시" class="sido-opt">대전광역시</option>
                        <option value="세종특별자치시" class="sido-opt">세종특별자치시</option> 
                        <option value="경기도" class="sido-opt">경기도</option>
                        <option value="강원도" class="sido-opt">강원도</option>
                        <option value="충청북도" class="sido-opt">충청북도</option>
                        <option value="충청남도" class="sido-opt">충청남도</option> 
                        <option value="전라북도" class="sido-opt">전라북도</option>
                        <option value="전라남도" class="sido-opt">전라남도</option>
                        <option value="경상북도" class="sido-opt">경상북도</option>
                        <option value="경상남도" class="sido-opt">경상남도</option> 
                        <option value="제주특별자치시" class="sido-opt">제주특별자치시</option>
                    </select>
                </div>

                <div class="sigungu">
                     <select name="sigungu" class="origin-sigungu sigungu-select options selectcss">
                        <%# default 값 %>
                        <option value="전체" class="sigungu-opt">--전체선택--</option>
                     </select>
                </div>
                
            </div>

            <br>
            <div class="d-flex justify-content-between original-check">
                <div>
                    <div class="a-type"><div class="d-flex typebox justify-content-around"><div class="typename">유제품 및 난류</div><i class="downic fas fa-caret-down"></i></div></div>
                    <div class="allergy-check">
                        <%= check_box_tag :a9_nanryu, checked = true%> 난류<br>
                        <%= check_box_tag :a10_milk, checked = true%> 우유<br>
                    </div>
                </div>
                <div>
                    <div class="a-type"><div class="d-flex typebox justify-content-around"><div class="typename">과채류 및 곡류</div><i class="downic fas fa-caret-down"></i></div></div>
                    <div class="allergy-check">
                        <%= check_box_tag :a6_peach, checked = true%> 복숭아<br>
                        <%= check_box_tag :a7_tomato, checked = true%> 토마토<br>
                        <%= check_box_tag :a1_maemil, checked = true%> 메밀<br>
                        <%= check_box_tag :a2_mil, checked = true%> 밀<br>
                        <%= check_box_tag :a3_daedu, checked = true%> 대두(콩)<br>
                    </div>
                </div>
                <div>
                    <div class="a-type"><div class="d-flex typebox justify-content-around"><div class="typename">육류</div><i class="downic fas fa-caret-down"></i></div></div>
                    <div class="allergy-check">
                        <%= check_box_tag :a11_ddakgogi, checked = true%> 닭고기<br>
                        <%= check_box_tag :a12_shoigogi, checked = true%> 쇠고기<br>
                        <%= check_box_tag :a8_piggogi, checked = true%> 돼지고기<br>
                    </div>
                </div>
                <div>
                    <div class="a-type"><div class="d-flex typebox justify-content-around"><div class="typename">어패류</div><i class="downic fas fa-caret-down"></i></div></div>
                    <div class="allergy-check d-flex">
                        <div>
                            <%= check_box_tag :a13_saewoo, checked = true%> 새우<br>
                            <%= check_box_tag :a14_godeungeoh, checked = true%> 고등어<br>
                            <%= check_box_tag :a15_honghap, checked = true%> 홍합<br>
                            <%= check_box_tag :a16_junbok, checked = true%> 전복<br>
                        </div>
                        <div class="fish2">
                            <%= check_box_tag :a17_gul, checked = true%> 굴<br>
                            <%= check_box_tag :a18_jogaeryu, checked = true%> 조개류<br>
                            <%= check_box_tag :a19_gye, checked = true%> 게<br>
                            <%= check_box_tag :a20_ohjingeoh, checked = true%> 오징어<br>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="a-type"><div class="d-flex typebox justify-content-around"><div class="typename fruits">과류, 아황산 등</div><i class="downic fas fa-caret-down"></i></div></div>
                    <div class="allergy-check">
                        <%= check_box_tag :a4_hodu, checked = true%> 호두<br>
                        <%= check_box_tag :a5_ddangkong, checked = true%> 땅콩<br>
                        <%= check_box_tag :a21_ahwangsan, checked = true%> 아황산류<br>
                    </div>
                </div>
                
                <button type="submit" class="a-submit">
                 Search<i class="fas fa-search"></i>
                </button>
            </div>
                
        <%end%>
    
    </div>
    
</div>
<div id="myinfo" class="getinfo">
    <%= render partial: 'custom' %>
</div>
<button id="custom" class="mbutton fill"><div id="ct" style="color:black; text-decoration: none;">내 알러지정보 불러오기</div></button>



<%# <button id="reset" onClick="funcreset()">초기화</button> %>
<%# <p id="myinfo" style="display:none;">로그인해주세요</p> %>


<script>
    var sigungu;
    let sigungu_length;
    $("#custom-alert").click(function(){
        alert("로그인이 필요한 기능입니다");
    });

    $(".sido-select").click(function() {
        var sido = $(this).val();
        console.log(sido);
        
        $.ajax({
            async : true,
            data : {sido : sido},
            type : "GET",
            url : "getGungu",
            success : function(data){
                
                sigungu = data["sigungu_name"];
                if(sido != "시도"){
                    sigungu_length = Object.keys(sigungu).length;
                    var options = '';
                    options += '<option value="' +"전체"+ '">' + "--전체선택--" + '</option>';
                    for (var i = 0; i <sigungu_length; i++) {
                        options += '<option value="' + sigungu[i]+'"'+'class='+'"sigungu-opt"'+'>' + sigungu[i] + '</option>';
                    }

                    $(".sigungu-select").html(options);
                }

            }
        })
    });

    $(".a-submit").click(function(){
        if($(".origin-sido").val()=="시도"){
             alert("시/도를 선택하세요");
             return false;//alert 창 닫기.
        }
    });
   
   $("#custom").click(function(){
        if( $(this).children("#ct").html() == "내 알러지정보 불러오기")
        {   
            $(".original-check").addClass("getinfo");
            $("#myinfo").removeClass("getinfo");
            $(".allergy-check").css('visibility','visible');
           
            $(this).children("#ct").html("되돌리기");
            
            $(".custom-sido").val($(".origin-sido").val());
            $(".custom-sigungu").val($(".origin-sigungu").val());
            $(".custom-sigungu").html($(".origin-sigungu").html());
        }
        else
        {
            $(".original-check").removeClass("getinfo");
            $("#myinfo").addClass("getinfo");
            $(this).children("#ct").html("내 알러지정보 불러오기");
            $(".origin-sido").val($(".custom-sido").val());
            $(".origin-sigungu").val($(".custom-sigungu").val());
            $(".origin-sigungu").html($(".custom-sigungu").html());
        }

    });

    //페이지 뒤로 넘어가기 했을 시에 에러 수정.
    var sido = $(".sido-select").val();
    console.log(sido);
    
    $.ajax({
        async : true,
        data : {sido : sido},
        type : "GET",
        url : "getGungu",
        success : function(data){
            
            sigungu = data["sigungu_name"];
            if(sido != "시도"){
                sigungu_length = Object.keys(sigungu).length;
                var options = '';
                options += '<option value="' +"전체"+ '">' + "--전체선택--" + '</option>';
                for (var i = 0; i <sigungu_length; i++) {
                    options += '<option value="' + sigungu[i]+'"'+'class='+'"sigungu-opt"'+'>' + sigungu[i] + '</option>';
                }

                $(".sigungu-select").html(options);
            }

        }
    })
    //에러 수정 끝
</script>
